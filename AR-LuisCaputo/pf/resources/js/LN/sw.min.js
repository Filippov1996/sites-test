(() => {
    var c = "UA-621326-134";
    self.addEventListener("install", function(n) {});
    self.addEventListener("activate", function(n) {});
    self.addEventListener("fetch", function(n) {});
    self.addEventListener("notificationclick", n => {
        n.preventDefault(), n.notification.close();
        let t = n.notification.data;
        l("opened", "notification", t);
        let e = n.target.location.origin + "/";
        t.url ? e = t.url : t.notaid && (e = e + t.notaid), n.waitUntil(clients.matchAll({
            type: "window"
        }).then(function(i) {
            let o = i.find(r => r.visibilityState === "visible");
            o ? o.navigate(e).focus() : clients.openWindow(e)
        }))
    });
    self.addEventListener("push", function(n) {
        let t = {};
        n.data && (t = n.data.json(), t = t.data, console.log(t), l("received", "notification", t), n.waitUntil(self.registration.showNotification(t.title, {
            icon: "/nt_icon.png",
            badge: "/pwa_128.png",
            body: t.message,
            image: t.image,
            vibrate: [100, 50, 100],
            tag: t.notaid,
            data: t
        })))
    });

    function l(n, t, e) {
        "use strict";
        return c ? !n && !t ? (console.warn("sendAnalyticsEvent() called with no eventAction or eventCategory."), Promise.resolve()) : self.registration.pushManager.getSubscription().then(function(i) {
            if (i === null) throw new Error("No subscription currently available.");
            var o = {
                    v: 1,
                    cid: i.endpoint,
                    tid: c,
                    t: "event",
                    ec: t,
                    ea: n,
                    el: e.titulo,
                    cd1: e.notaid,
                    cd2: e.sitioid,
                    cd3: e.tipo,
                    cd4: e.id
                },
                r = Object.keys(o).filter(function(a) {
                    return o[a]
                }).map(function(a) {
                    return a + "=" + encodeURIComponent(o[a])
                }).join("&");
            return fetch("https://www.google-analytics.com/collect", {
                method: "post",
                body: r
            })
        }).then(function(i) {
            if (i.ok) console.log(t + "/" + n + " hit sent, check the Analytics dashboard");
            else return i.text().then(function(o) {
                throw new Error(`Bad response from Google Analytics:
` + i.status)
            })
        }).catch(function(i) {
            console.warn("Unable to send the analytics event", i)
        }) : (console.error("You need your tracking ID in analytics-helper.js"), console.error(`Add this code:
var trackingId = 'UA-XXXXXXXX-X';`), Promise.resolve())
    }
})();